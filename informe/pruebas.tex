\section{Pruebas y Validación}

Esta sección describe las pruebas realizadas para verificar el correcto funcionamiento de la topología, el controlador SDN y las reglas del firewall.

\subsection{Configuración del Entorno de Pruebas}

Todas las pruebas se realizaron siguiendo el siguiente procedimiento:

\begin{enumerate}
    \item \textbf{Iniciar el controlador} (Terminal 1):
    \begin{verbatim}
    ./run_controller.sh
    \end{verbatim}
    
    \item \textbf{Iniciar la topología} (Terminal 2):
    \begin{verbatim}
    ./run_topology.sh 2    # Para N=2 switches
    \end{verbatim}
    
    \item \textbf{Esperar a que los switches se conecten} y las reglas se instalen.
\end{enumerate}

\textbf{Importante}: El controlador debe iniciarse \textit{antes} que la topología para que los switches puedan conectarse al momento de su creación.

\subsection{Verificación Básica: Conectividad}

\subsubsection{Prueba 1: PingAll}

\textbf{Objetivo}: Verificar que todos los hosts pueden comunicarse entre sí (excepto donde el firewall lo impide).

\textbf{Comando}:
\begin{verbatim}
mininet> pingall
\end{verbatim}

\textbf{Resultado Esperado}:
\begin{itemize}
    \item $h_1 \leftrightarrow h_2$: Conectividad exitosa
    \item $h_1 \leftrightarrow h_3$: Conectividad exitosa
    \item $h_1 \leftrightarrow h_4$: Conectividad exitosa
    \item $h_2 \leftrightarrow h_3$: Bloqueado (Regla 3)
    \item $h_2 \leftrightarrow h_4$: Conectividad exitosa
    \item $h_3 \leftrightarrow h_4$: Conectividad exitosa
\end{itemize}

\textbf{Logs del Controlador}:
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{carga_reglas_logs.png}
    \caption{Carga de las reglas al switch}
    \label{fig:carga_reglas_logs}
\end{figure}
Desde los logs del controlador podemos observar que las reglas fueron instaladas con exito en el switch 1.

\textbf{Captura de Mininet}:
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{resultado_pingall.png}
    \caption{Resultado de pingall}
    \label{fig:resultado_pingall}
\end{figure}

\textbf{Capturas de Wireshark}:
Captura de interfaz de s1 que conecta con h2:
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{resultado_pingall_h2.png}
    \caption{Resultado de pingall para h2}
    \label{fig:resultado_pingall_h2}
\end{figure}
Se puede observar que se envia un mensaje de ping a h3 pero no se recibe respuesta.
Tampoco se recibe un ping de h3.\\

Captura de interfaz de s2 que conecta con h3:
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{resultado_pingall_h3.png}
    \caption{Resultado de pingall para h3}
    \label{fig:resultado_pingall_h3}
\end{figure}
En este caso no se recibe respuesta del ping a h2 ni se recibe un ping de este ultimo.\\

Captura de interfaz de s1 que conecta con s2:
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{resultado_pingall_switches.png}
    \caption{Resultado de pingall en los switches}
    \label{fig:resultado_pingall_switches}
\end{figure}
Se observa que no se envian los pings de h2 a h3 y viceversa ya que estos son descartados.

\subsection{Pruebas de Firewall}

\subsubsection{Prueba 2: Bloqueo de Puerto 80 (HTTP) - Regla 1}

\textbf{Objetivo}: Verificar que todo el tráfico al puerto 80 es bloqueado.

\textbf{Configuración}:
\begin{verbatim}
# Terminal h1 - Iniciar servidor HTTP en puerto 80
mininet> h1 python3 -m http.server 80 &

# Terminal h4 - Intentar acceder desde otro host
mininet> h4 curl -m 5 http://10.0.0.1:80
\end{verbatim}

\textbf{Resultado Esperado}: Timeout (conexión bloqueada por firewall)

\textbf{Resultado Obtenido}:
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{resultado_curl_h4-h1.png}
    \caption{Resultado de curl de h4 a h1}
    \label{fig:resultado_curl_h4-h1}
\end{figure}

\textbf{Verificación con iperf}:
\begin{verbatim}
# Servidor en h1
mininet> h1 iperf -s -p 80 &

# Cliente en h4
mininet> h4 iperf -c 10.0.0.1 -p 80 -t 5
\end{verbatim}

\textbf{Resultado}: No se establece conexión.
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{resultado_iperf_h4-h1.png}
    \caption{Resultado de iperf de h4 a h1 en puerto 80}
    \label{fig:resultado_iperf_h4-h1}
\end{figure}

\textbf{Verificación con Wireshark}

Para confirmar el bloqueo, se capturó tráfico en las interfaces relevantes del recorrido \texttt{h4 → h1}. En s2-eth2 (salida de h4) se observan múltiples \texttt{SYN} retransmitidos, señal de que el cliente intenta iniciar la conexión sin obtener respuesta. En s1-eth1 (camino hacia h1) no aparece ningún paquete al puerto 80, lo que confirma que el firewall descarta el tráfico antes de que alcance el destino.
\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{resultado_wireshark_bloqueo_h4-h1.png}
    \caption{Captura de Wireshark: bloqueo de h4 a h1 en puerto 80}
    \label{fig:resultado_iperf_h4-h1}
\end{figure}

\textbf{Prueba de Control (puerto no bloqueado)}:
\begin{verbatim}
mininet> h1 python3 -m http.server 8000 &
mininet> h4 curl http://10.0.0.1:8000
\end{verbatim}

\textbf{Resultado}: Conexión exitosa (el puerto 8000 no está bloqueado).
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{resultado_curl_8000_h4-h1.png}
    \caption{Resultado de curl de h4 a h1 en puerto 8000}
    \label{fig:resultado_curl_8000_h4-h1}
\end{figure}

\textbf{Verificación con Wireshark}

Para este caso se capturó tráfico en las mismas interfaces que en la prueba anterior. En s2-eth2 y s1-eth1 se observa el three-way handshake completo (SYN, SYN/ACK, ACK), seguido por el intercambio normal de paquetes HTTP. La presencia del \texttt{GET} y la respuesta \texttt{200 OK} confirma que el tráfico atraviesa ambos switches sin ser filtrado por el firewall.

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{resultado_wireshark_no_bloqueo_h4-h1.png}
    \caption{Captura de Wireshark: tráfico de h4 a h1 en puerto 8000}
    \label{fig:resultado_iperf_h4-h1}
\end{figure}

\subsubsection{Prueba 3: Bloqueo UDP Específico - Regla 2}

\textbf{Objetivo}: Verificar que el tráfico UDP desde $h_1$ al puerto 5001 es bloqueado.

\textbf{Configuración}:
\begin{verbatim}
# Servidor UDP en h4
mininet> h4 iperf -s -u -p 5001 &

# Cliente desde h1 (bloqueado)
mininet> h1 iperf -c 10.0.0.4 -u -p 5001 -t 5

# Cliente desde h2 (permitido)
mininet> h2 iperf -c 10.0.0.4 -u -p 5001 -t 5
\end{verbatim}

\textbf{Resultados Esperados}:
\begin{itemize}
    \item Desde $h_1$: 0\% de paquetes recibidos (bloqueado)
    \item Desde $h_2$: 100\% de paquetes recibidos (permitido)
\end{itemize}

\textbf{Resultados Obtenidos}:
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{resultado_iperf_udp.png}
    \caption{Resultado de iperfs udp de h1 y h2 a h4 en puerto 5001}
    \label{fig:resultado_iperf_udp}
\end{figure}

\subsubsection{Prueba 4: Bloqueo Bidireccional - Regla 3}

\textbf{Objetivo}: Verificar que $h_2$ y $h_3$ no pueden comunicarse en ninguna dirección.

\textbf{Test 1: ICMP (ping)}
\begin{verbatim}
mininet> h2 ping -c 4 h3
mininet> h3 ping -c 4 h2
\end{verbatim}

\textbf{Resultado Esperado}: 100\% packet loss en ambas direcciones.

\textbf{Resultados Obtenidos}:
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{pings_h2_h3.png}
    \caption{Resultado de pings entre h2 y h3}
    \label{fig:pings_h2_h3}
\end{figure}

\textbf{Test 2: TCP (iperf)}
\begin{verbatim}
mininet> h3 iperf -s &
mininet> h2 iperf -c 10.0.0.3 -t 5
mininet> h2 iperf -s &
mininet> h3 iperf -c 10.0.0.2 -t 5
\end{verbatim}

\textbf{Resultado Esperado}: No se establece conexión TCP.

\textbf{Resultado Obtenido}:
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{resultados_iperfs_h2-h3.png}
    \caption{Resultado de iperf entre h2 y h3}
    \label{fig:resultados_iperfs_h2-h3}
\end{figure}

\textbf{Prueba de Control}:
\begin{verbatim}
mininet> h2 ping -c 4 h1    # Debería funcionar
mininet> h3 ping -c 4 h4    # Debería funcionar
\end{verbatim}

\textbf{Resultado}: Conectividad exitosa (solo está bloqueada la comunicación entre h2 y h3).

\textbf{Resultado Obtenido}:
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{ping_h2-h1.png}
    \caption{Resultado de ping entre h2 y h1}
    \label{fig:ping_h2-h1}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{ping_h3-h4.png}
    \caption{Resultado de ping entre h3 y h4}
    \label{fig:ping_h3-h4}
\end{figure}

\subsection{Pruebas con Diferentes Topologías}

\subsubsection{Topología con N=1}

\textbf{Configuración}:
\begin{verbatim}
./run_topology.sh 1
\end{verbatim}

\textbf{Características}: Todos los hosts conectados al mismo switch (topología estrella).

\textbf{Resultado}: Las reglas del firewall se aplican correctamente independientemente de la topología.

\subsubsection{Topología con N=3}

\textbf{Configuración}:
\begin{verbatim}
./run_topology.sh 3
\end{verbatim}

\textbf{Características}: Cadena de 3 switches, aumenta la distancia entre hosts extremos.

\textbf{Resultado}: 
\begin{itemize}
    \item L2 learning funciona correctamente en topología extendida
    \item Firewall mantiene las reglas en todos los switches
    \item Latencia aumenta proporcionalmente con el número de saltos
\end{itemize}
